<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Espécies Observadas - Big Day</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .container { max-width: 900px; margin: 24px auto; padding: 16px; }
    .back { margin-bottom: 12px; display:inline-block; text-decoration:none; color:#2b6cb0; font-weight:600; }
    .species-table { width: 100%; }
    .species-table th { text-align: left; }
    .species-table td:nth-child(1) { text-align: center; width: 80px; }
    .species-header { text-align: center; margin-bottom: 20px; }
    /* Zebrado adicionado */
    .species-table tbody tr:nth-child(odd) { background: #fff; }
    .species-table tbody tr:nth-child(even) { background: #fbfcff; }
    .species-table tbody td { padding: 10px; border-bottom: 1px solid #f0f2f6; }
  </style>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
</head>
<body>
  <main class="container">
    <a class="back" href="index.html">← Voltar ao Ranking</a>
    
    <header class="header">
      <!-- Logo PNG com fundo transparente -->
      <div class="logo" id="logo">
        <img src="logo.png" alt="Big Day Logo" class="logo-image">
      </div>
      <h1 class="event-title">1º Big Day RS</h1>
      
      <!-- Totais do evento -->
      <div class="event-totals">
        <strong id="total-text">234 espécies - 78 listas</strong>
      </div>
    </header>

    <div class="card">
      <div class="table-wrap">
        <table id="species-table" class="species-table">
          <thead>
            <tr>
              <th>Observações</th>
              <th>Nome Popular</th>
              <th>Nome Científico</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </main>

  <script>
      // Função para processar CSV
      function parseCSV(csvText) {
        const lines = csvText.split('\n').filter(line => line.trim() !== '');
        const headers = lines[0].split(';').map(header => header.trim());
        
        const data = [];
        for (let i = 1; i < lines.length; i++) {
          const values = lines[i].split(';').map(value => value.trim());
          const item = {};
          headers.forEach((header, index) => {
            item[header] = values[index] || '';
          });
          data.push(item);
        }
        return data;
      }
  
      // Função para renderizar a tabela e atualizar contador
      function renderSpeciesTable(data) {
        const tbody = document.querySelector('#species-table tbody');
        tbody.innerHTML = '';
        
        data.forEach(species => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${species.observacoes}</td>
            <td>${species.nome_popular}</td>
            <td><em>${species.nome_cientifico}</em></td>
          `;
          tbody.appendChild(tr);
        });
        
        // Atualiza o contador
        document.getElementById('species-count').textContent = data.length;
      }
  
      // Função para buscar dados de atualização do script principal
      function loadUpdateDate() {
        if (typeof getUpdateText === 'function') {
          document.getElementById('update-date').textContent = getUpdateText();
        } else {
          document.getElementById('update-date').textContent = '31 de dezembro de 2024, 23:59';
        }
      }
  
      // Função para carregar dados de arquivo CSV externo
      async function loadCSVFromFile() {
        try {
          const response = await fetch('/especies.csv');
          if (response.ok) {
            const csvText = await response.text();
            return parseCSV(csvText);
          }
        } catch (error) {
          console.log('Tentando caminho relativo...');
        }
        
        try {
          const response = await fetch('especies.csv');
          if (response.ok) {
            const csvText = await response.text();
            return parseCSV(csvText);
          }
        } catch (error) {
          console.error('Erro ao carregar especies.csv:', error);
        }
        
        return [];
      }
  
      // Inicialização
      async function init() {
        const speciesData = await loadCSVFromFile();
        
        if (speciesData.length === 0) {
          const tbody = document.querySelector('#species-table tbody');
          tbody.innerHTML = `
            <tr>
              <td colspan="3" style="text-align: center; padding: 20px; color: #718096;">
                Arquivo especies.csv não encontrado. 
                Por favor, verifique se o arquivo está na pasta correta.
              </td>
            </tr>
          `;
          // Mantém o contador como 0
        } else {
          renderSpeciesTable(speciesData);
        }
        
        loadUpdateDate();
      }
  
      document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
